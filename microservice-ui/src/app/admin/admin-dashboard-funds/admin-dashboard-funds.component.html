<div class="admin-dashboard">
  <h2>{{ 'ADMIN_DASHBOARD.TITLE' | translate }}</h2>

  <!-- Language Switcher (optional) -->
  <div class="language-switcher" style="margin-bottom: 10px;">
    <select (change)="changeLanguage($event)">
      <option value="en">English</option>
      <option value="fr">Fran√ßais</option>
    </select>
  </div>

  <!-- Search, Filter and Refresh -->
  <div class="search-container" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
    
    <!-- Search Input -->
    <div class="search-input-container" style="flex: 1; display: flex; align-items: center; gap: 5px;">
      <input type="text" 
            placeholder="{{ 'ADMIN_DASHBOARD.SEARCH_PLACEHOLDER' | translate }}" 
            [(ngModel)]="searchQuery" 
            (input)="searchUsers()"
            (keyup)="searchUsers()" 
            style="flex: 1; padding: 5px;" />
      <button class="btn-refresh" 
              (click)="refreshUsers()" 
              [disabled]="refreshing"
              title="{{ 'ADMIN_DASHBOARD.REFRESH_LIST' | translate }}">
        <span *ngIf="!refreshing" class="refresh-icon">üîÑ</span>
        <span *ngIf="refreshing" class="refresh-icon spinning">‚è≥</span>
      </button>
    </div>

    <!-- Status Filter -->
    <div class="filter-container" style="display: flex; align-items: center;">
      <label class="filter-label">
        <span class="filter-text">{{ 'ADMIN_DASHBOARD.FILTER_STATUS' | translate }}</span>
        <select [(ngModel)]="selectedStatus" 
                (change)="onStatusFilterChange()"
                class="status-filter"
                style="margin-left: 5px; padding: 5px;">
                <option value="all">{{ 'ADMIN_DASHBOARD.STATUS_ALL' | translate }}</option>
                <option value="active">{{ 'ADMIN_DASHBOARD.STATUS_ACTIVE' | translate }}</option>
                <option value="temp-banned">{{ 'ADMIN_DASHBOARD.STATUS_TEMP_BANNED' | translate }}</option>
                <option value="permanently-banned">{{ 'ADMIN_DASHBOARD.STATUS_PERMANENTLY_BANNED' | translate }}</option>
        </select>
      </label>
    </div>

  </div>

  <!-- Active filters -->
  <div class="active-filters" *ngIf="searchQuery || selectedStatus !== 'all'" style="margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 5px;">
    <span *ngIf="searchQuery && searchQuery.trim() !== ''" class="filter-chip">
      üîç {{ 'ADMIN_DASHBOARD.FILTER_SEARCH' | translate }}: "{{ searchQuery }}"
      <button type="button" class="remove-filter" (click)="clearSearch()">‚úñ</button>
    </span>

    <span *ngIf="selectedStatus && selectedStatus !== 'all'" class="filter-chip">
      ‚ö° {{ 'ADMIN_DASHBOARD.FILTER_STATUS_LABEL' | translate }}: {{ getStatusLabel(selectedStatus) }}
      <button type="button" class="remove-filter" (click)="clearStatus()">‚úñ</button>
    </span>
  </div>

  <!-- Search results info -->
  <div *ngIf="isSearchActive() || selectedStatus !== 'all'" class="search-results-info" style="margin-bottom: 10px; font-style: italic;">
    {{ getSearchResultsCount() }} {{ 'ADMIN_DASHBOARD.RESULTS_FOUND' | translate }}
  </div>

  <!-- Users Table -->
  <div class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>{{ 'ADMIN_DASHBOARD.TABLE.ID' | translate }}</th>
          <th>{{ 'ADMIN_DASHBOARD.TABLE.USERNAME' | translate }}</th>
          <th>{{ 'ADMIN_DASHBOARD.TABLE.EMAIL' | translate }}</th>
          <th>{{ 'ADMIN_DASHBOARD.TABLE.BALANCE' | translate }}</th>
          <th>{{ 'ADMIN_DASHBOARD.TABLE.STATUS' | translate }}</th>
          <th>{{ 'ADMIN_DASHBOARD.TABLE.ACTIONS' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of pagedUsers" 
            [class.row-banned]="!user.active"
            [class.row-temp-banned]="user.active && isTemporarilyBanned(user)"
            [class.row-active]="user.active && !isTemporarilyBanned(user)">
          <td>{{ user.id }}</td>
          <td style="font-size: 20px; font-weight: bold;">{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td><strong>{{ user.balance | currency:'EUR':'symbol':'1.2-2' }}</strong></td>
          <td>
            <span *ngIf="!user.active" class="inactive">{{ 'ADMIN_DASHBOARD.STATUS_PERMANENTLY_BANNED' | translate }}</span>
            <span *ngIf="user.active && isTemporarilyBanned(user)" class="temp-banned">
              {{ 'ADMIN_DASHBOARD.STATUS_TEMP_BANNED_UNTIL' | translate }} {{ user.bannedUntil | date:'dd/MM/yyyy' }}
            </span>
            <span *ngIf="user.active && !isTemporarilyBanned(user)" class="active">
              {{ 'ADMIN_DASHBOARD.STATUS_ACTIVE' | translate }}
            </span>
          </td>
          <td class="actions">
            <input type="number" 
                   [ngModel]="getUserAmount(user.id)" 
                   (ngModelChange)="updateUserAmount(user.id, $event)"
                   placeholder="{{ 'ADMIN_DASHBOARD.INPUT_AMOUNT' | translate }}" 
                   class="amount-input"
                   min="0"
                   step="0.01" />
            <button class="btn-action btn-credit" 
                    (click)="creditBalance(user.id)"
                    title="{{ 'ADMIN_DASHBOARD.BUTTON_CREDIT' | translate }}">
              üí∞ {{ 'ADMIN_DASHBOARD.BUTTON_CREDIT' | translate }}
            </button>
            <button class="btn-action btn-debit" 
                    (click)="debitBalance(user.id)"
                    title="{{ 'ADMIN_DASHBOARD.BUTTON_DEBIT' | translate }}">
              üí∏ {{ 'ADMIN_DASHBOARD.BUTTON_DEBIT' | translate }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator
    [length]="filteredUsers.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="[25, 50, 100]"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>

</div>
